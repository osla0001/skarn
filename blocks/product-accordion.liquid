{% comment %}
Accordion block for product page
- Heading (h3) left, arrow SVG right
- Click toggles description
{% endcomment %}

<div class="product-accordion-block">
  <button class="product-accordion-toggle" type="button" aria-expanded="false">
    <span class="product-accordion-heading">{{ block.settings.heading }}</span>
    <span class="product-accordion-arrow" aria-hidden="true">
      <!-- SVG arrow, always black -->
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" style="color: #000;" xmlns="http://www.w3.org/2000/svg"><path d="M8 10L12 14L16 10" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </span>
  </button>
  {% if block.settings.accordion_type == 'image' %}
    <div class="product-accordion-content product-accordion-content--with-image" hidden>
      <div class="product-accordion-grid">
        <div class="product-accordion-description">{{ block.settings.description }}</div>
        {%- assign overkategori = product.metafields.custom.overkategori | downcase -%}
        {%- case overkategori -%}
          {%- when "overdel" -%}
            <div class="product-accordion-image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/0994/5386/2229/files/Overdel.png?v=1771586352" class="product-accordion-image" alt="Overdel billede">
            </div>
          {%- when "underdel" -%}
            <div class="product-accordion-image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/0994/5386/2229/files/Underdel.png?v=1771586352" class="product-accordion-image" alt="Underdel billede">
            </div>
          {%- when "hat" -%}
            <div class="product-accordion-image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/0994/5386/2229/files/Hat.png?v=1771586352" class="product-accordion-image" alt="Hat billede">
            </div>
          {%- when "taske" -%}
            <div class="product-accordion-image-wrapper">
              <img src="https://cdn.shopify.com/s/files/1/0994/5386/2229/files/Taske.png?v=1771586352" class="product-accordion-image" alt="Taske billede">
            </div>
          {%- else -%}
            <div class="product-accordion-image-wrapper">
              <img src="{{ 'sti/til/ingen-maal.jpg' }}" class="product-accordion-image" alt="Ingen mÃ¥l billede">
            </div>
        {%- endcase -%}
      </div>
    </div>
  {% else %}
    <div class="product-accordion-content" hidden>
      <div class="product-accordion-description">{{ block.settings.description }}</div>
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "Accordion",
  "settings": [
    {
      "type": "select",
      "id": "accordion_type",
      "label": "Accordion type",
      "options": [
        { "value": "normal", "label": "Normal" },
        { "value": "image", "label": "Med billede" }
      ],
      "default": "normal"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Overskrift"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Beskrivende tekst"
    }
  ],
  "presets": [
    { "name": "Accordion" }
  ]
}
{% endschema %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.product-accordion-toggle').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', !expanded);
      var content = btn.nextElementSibling;
      if (content && content.classList.contains('product-accordion-content')) {
        if (!expanded) {
          content.hidden = false;
          // Force reflow for transition
          void content.offsetWidth;
          content.classList.add('open');
        } else {
          content.classList.remove('open');
          // Wait for transition to finish before hiding
          content.addEventListener('transitionend', function handler(e) {
            if (e.propertyName === 'max-height') {
              content.hidden = true;
              content.removeEventListener('transitionend', handler);
            }
          });
        }
      }
    });
  });
  // Ensure closed accordions are hidden for accessibility
  document.querySelectorAll('.product-accordion-toggle').forEach(function(btn) {
    var content = btn.nextElementSibling;
    if (content && content.classList.contains('product-accordion-content')) {
      if (btn.getAttribute('aria-expanded') !== 'true') {
        content.hidden = true;
        content.classList.remove('open');
      } else {
        content.hidden = false;
        content.classList.add('open');
      }
    }
  });
});
{% endjavascript %}

<style>
.product-accordion-arrow svg {
  color: #000 !important;
  stroke: #000 !important;
}
</style>
<style>
.product-accordion-content--with-image .product-accordion-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
  align-items: start;
}
.product-accordion-image-wrapper {
  display: flex;
  align-items: flex-start;
  justify-content: flex-end;
}
.product-accordion-image {
  max-width: 100%;
  height: auto;
  display: block;
}
</style>
</style>
