<script
  src="{{ 'product-recommendations.js' | asset_url }}"
  type="module"
></script>

{% liquid
  assign recommendation_products = recommendations.products

  if recommendations.performed and recommendations.products_count == 0
    if section.settings.recommendation_type == 'related'
      assign recommendation_products = collections.all.products | reject: 'id', product.id
    endif
  endif
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="
    section
    section--{{ section.settings.section_width }}
    color-{{ section.settings.color_scheme }}
    section-resource-list
    spacing-style
    gap-style
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
  "
>
  <div class="section-resource-list__content">
    {%- content_for 'blocks' -%}
  </div>

  {% capture list_items %}
    <div class="resource-list__blank-item">
      <h2 class="featured-collection__title" style="text-align:left; margin-bottom: 1rem;">{{ section.settings.title | default: 'Udvalgte produkter' }}</h2>
    </div>
    {% for product_item in recommendation_products limit: section.settings.max_products %}
      <div class="resource-list__item">
        {% content_for 'block',
          type: '_product-card',
          id: 'static-product-card',
          closest.product: product_item
        %}
      </div>
      {% unless forloop.last %}
        <!--@list/split-->
      {% endunless %}
    {% endfor %}
  {% endcapture %}

  {% assign list_items_array = list_items | strip | split: '<!--@list/split-->' %}

  <div class="resource-list resource-list--grid featured-collection__scroll"
    style="overflow-x: auto; white-space: nowrap; scrollbar-width: thin;"
    data-testid="featured-collection-grid">
    {{ list_items }}
  </div>
</div>
<style>
.featured-collection__header {
  width: 100%;
  margin-bottom: 0.5rem;
}
.featured-collection__title {
  font-family: "ZT Nature Thin", sans-serif;
  font-size: 2rem;
  font-weight: 100;
  text-transform: uppercase;
  margin: 0;
  padding: 0 0 0.5rem 0;
}
.featured-collection__scroll {
  display: flex;
  gap: var(--resource-list-column-gap-desktop, 16px);
  overflow-x: auto;
  scrollbar-width: thin;
  padding-bottom: 0.5rem;
}
.featured-collection__scroll .resource-list__item {
  flex: 0 0 auto;
  aspect-ratio: 1 / 1;
  width: 220px;
  max-width: 100vw;
  box-sizing: border-box;
}
</style>

{% schema %}
{
  "name": "Product recommendations",
  "class": "ui-test-product-recommendations",
  "settings": [
    {
      "type": "select",
      "id": "recommendation_type",
      "label": "Recommendation type",
      "options": [
        { "value": "related", "label": "Related" },
        { "value": "complementary", "label": "Complementary" }
      ],
      "default": "related"
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Products to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout_type",
      "label": "Layout style",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "carousel", "label": "Carousel" }
      ],
      "default": "grid"
    },
    {
      "type": "checkbox",
      "id": "carousel_on_mobile",
      "label": "Carousel on mobile",
      "default": false
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Columns",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "rows_gap",
      "label": "Vertical gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Section layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Width",
      "options": [
        { "value": "page-width", "label": "Page width" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Content gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    }
  ],
  "presets": [
    {
      "name": "Product recommendations",
      "category": "Product"
    }
  ]
}
{% endschema %}