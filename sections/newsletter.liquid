{% comment %}
  Dynamisk nyhedsbrev-sektion, så alt indhold og styling kan redigeres i Shopify Theme Editor.
{% endcomment %}

<section class="section-wrapper newsletter">
  <div class="section-background color-scheme-2"></div>
  <div class="section section--page-width color-scheme-2" data-testid="ui-test-section">
    <div class="custom-section-background"></div>
    <div class="border-style custom-section-content" style="--border-width: 1px; --border-style: none; --border-color: rgb(var(--color-border-rgb) / 1.0); --border-radius: 0px;">
      <div class="spacing-style layout-panel-flex layout-panel-flex--column section-content-wrapper mobile-column"
        style="--flex-direction: column; --flex-wrap: nowrap; --flex-wrap-mobile: wrap; --gap: 16px; --horizontal-alignment: center; --vertical-alignment: center; --vertical-alignment-mobile: center; --padding-block-start: max(20px, calc(var(--spacing-scale) * 40px)); --padding-block-end: max(20px, calc(var(--spacing-scale) * 40px));"
        data-testid="section-content">

        {% if section.settings.heading != blank %}
          <rte-formatter class="spacing-style text-block rte text-block--align-center" style="--width: 100%; --max-width: var(--max-width--body-normal); --text-align: center;">
            <h2>{{ section.settings.heading }}</h2>
          </rte-formatter>
        {% endif %}

        {% if section.settings.subtext != blank %}
          <rte-formatter class="spacing-style text-block paragraph rte text-block--align-center" style="--color: var(--color-foreground); --width: 100%; --max-width: var(--max-width--body-normal); --text-align: center;">
            <p>{{ section.settings.subtext }}</p>
          </rte-formatter>
        {% endif %}

        <div class="email-signup-block size-style spacing-style" style="--size-style-width:50%;">
          <form method="post" action="/contact#contact_form" id="contact_form" accept-charset="UTF-8" class="email-signup__form spacing-style">
            <input type="hidden" name="form_type" value="customer">
            <input type="hidden" name="utf8" value="✓">
            <div class="email-signup__input-group" style="--border-width: 1px; --border-radius: 0px;">
              <label for="EmailInput-newsletter" class="visually-hidden">Mail</label>
              <input id="EmailInput-newsletter" class="email-signup__input email-signup__input--all paragraph" type="email" name="contact[email]" autocorrect="off" autocapitalize="off" autocomplete="email" placeholder="{{ section.settings.input_placeholder | default: 'Mailadresse' }}" required>
              <button id="newsletter-submit" class="email-signup__button email-signup__button--text paragraph button-secondary" type="submit">
                <span id="newsletter-btn-text">{{ section.settings.button_label | default: 'Tilmeld' }}</span>
                <span id="newsletter-check" style="display:none;margin-left:8px;">&#10003;</span>
              </button>
            </div>
          </form>
        </div>


<script>
document.addEventListener('DOMContentLoaded', function() {
  var form = document.getElementById('contact_form');
  var btn = document.getElementById('newsletter-submit');
  var btnText = document.getElementById('newsletter-btn-text');
  var check = document.getElementById('newsletter-check');
  // Funktion til at vise "tilmeldt" state
  function setSubscribedState() {
    btn.style.background = '#000';
    btn.style.color = '#fff';
    btn.setAttribute('disabled', 'disabled');
    btn.classList.add('submitted');
    btnText.textContent = 'Tilmeldt';
    btnText.style.color = '#fff';
    check.style.display = 'inline-block';
  }
  // Hvis brugeren allerede har tilmeldt sig (tjek localStorage)
  if(window.localStorage && localStorage.getItem('newsletter_subscribed')) {
    setSubscribedState();
  }
  if(form && btn && btnText && check) {
    form.addEventListener('submit', function(e) {
      // Vent på at Shopify har sendt formularen
      setTimeout(function() {
        setSubscribedState();
        if(window.localStorage) localStorage.setItem('newsletter_subscribed', '1');
      }, 300);
    });
  }
});
</script>

<style>
#newsletter-submit {
  transition: background 0.2s, color 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
#newsletter-submit[disabled], #newsletter-submit.submitted {
  background: #000 !important;
  color: #fff !important;
  cursor: not-allowed;
}
#newsletter-btn-text {
  transition: color 0.2s;
}
#newsletter-submit[disabled] #newsletter-btn-text,
#newsletter-submit.submitted #newsletter-btn-text {
  color: #fff !important;
}
#newsletter-check {
  font-size: 1.2em;
  vertical-align: middle;
  display: inline-block;
  margin-left: 0;
  color: #fff !important;
}
</style>

      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Nyhedsbrev",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Overskrift",
      "default": "Nyhedsbrev"
    },
    {
      "type": "text",
      "id": "subtext",
      "label": "Undertekst",
      "default": "Vær den første til at få besked om nye kollektioner og særlige tilbud."
    },
    {
      "type": "text",
      "id": "input_placeholder",
      "label": "Input placeholder",
      "default": "mail@adresse.dk"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Knap tekst",
      "default": "Tilmeld"
    }
  ],
  "presets": [
    {
      "name": "Nyhedsbrev"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .newsletter{
    padding-bottom: 4rem;
  }

  .email-signup__input-group input{
    border: 1px solid black;
    padding: 5px 10px;
    text-align: center;
    width: 100%;
  }

  .email-signup__input-group {
    display: flex;
    flex-direction: column;
    gap: 1rem !important;
  }
{% endstylesheet %}
