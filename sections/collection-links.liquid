

{% liquid %}

<script
  src="{{ 'collection-links.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }} spacing-style"
  style="{% render 'spacing-style', settings: section.settings %}"
  style="padding-top: {{ section.settings.padding_top | default: 0 }}px; padding-bottom: {{ section.settings.padding_bottom | default: 24 }}px; {% render 'spacing-style', settings: section.settings %}"
  data-testid="collection-links-{{ section.id }}"
>
  <h2 style="text-align:center;" class="h2_title">{{ section.settings.heading | default: 'Kategorier' }}</h2>
  <collection-links-component
    layout="{{ section.settings.layout }}"
    alignment="{{ section.settings.alignment }}"
    {% if section.settings.image_position == 'left' %}
      reverse
    {% endif %}
  >
    <div
      class="collection-links__container"
      ref="container"
    >
      {% if section.blocks.size > 0 %}
        {% for block in section.blocks %}
          {% assign link_label = block.settings.label %}
          {% if link_label == blank and block.settings.link_type == 'collection' and block.settings.collection != blank %}
            {% assign link_label = block.settings.collection.title %}
          {% endif %}
          {% if block.settings.link_type == 'custom' and block.settings.custom_url != blank %}
            {% assign link_url = block.settings.custom_url %}
          {% elsif block.settings.link_type == 'collection' and block.settings.collection != blank %}
            {% assign link_url = block.settings.collection.url %}
          {% else %}
            {% assign link_url = '#' %}
          {% endif %}
          <a class="collection-links__link" href="{{ link_url }}">
            <span>{{ link_label }}</span>
          </a>
        {% endfor %}
      {% else %}
        <div style="padding:2rem; color:#222; background:#fff; border:1px solid #eee;">Ingen links tilføjet – tilføj blokke i Theme Editor for at vise links her.</div>
      {% endif %}
    </div>

    {% case section.settings.layout %}
      {% when 'spotlight' %}
        {% capture slides %}
          {% for block in section.blocks %}
            {% capture slide %}
              {% render block, image_only: true %}
            {% endcapture %}
            {% render 'slideshow-slide', children: slide, index: forloop.index0 %}
          {% endfor %}
        {% endcapture %}
        {% render 'slideshow',
          slides: slides,
          slide_count: section.blocks.size,
          class: 'collection-links__images',
          ref: 'slideshow'
        %}
    {% endcase %}
  </collection-links-component>
</div>

{% # theme-check-disable ValidBlockTarget %}
{% stylesheet %}
  collection-links-component {
    --alignment: flex-start;

    display: grid;
    align-items: center;
    grid-gap: var(--gap-3xl);

    &:has([ratio='portrait']) {
      --template-column-ratio: 0.8fr;
    }

    &:has([ratio='square']) {
      --template-column-ratio: 1fr;
    }

    &:has([ratio='landscape']) {
      --template-column-ratio: 1.4fr;
    }

    &[alignment='center'] {
      --alignment: center;

      .text-block {
        text-align: center;
      }
    }

    &[alignment='right'] {
      --alignment: flex-end;

      .text-block {
        text-align: right;
      }
    }

    &[layout='spotlight'] {
      position: relative;
      grid-template-columns: 1fr var(--template-column-ratio);
      grid-template-areas: 'text image';

      @media (min-width: 749px) {
        &[reverse] {
          grid-template-areas: 'image text';
          grid-template-columns: var(--template-column-ratio) 1fr;
        }
      }

      .collection-links__container {
        align-items: var(--alignment);
      }

      @media (max-width: 749px) {
        grid-template-columns: 1fr;
        grid-template-areas: 'text' 'image';
        grid-gap: var(--gap-2xl);

        .collection-links__container {
          gap: clamp(var(--gap-xs), 1vw, var(--gap-xl)) var(--gap-2xl);
          justify-content: var(--alignment);
        }
      }
    }

    &[layout='text'] {
      grid-gap: 0;
      grid-template-areas: 'text';

      .collection-links__container {
        gap: clamp(var(--gap-xs), 1vw, var(--gap-xl)) var(--gap-2xl);
        flex-wrap: wrap;
        flex-direction: row;
        justify-content: var(--alignment);
      }
    }
  }

  .collection-links__container {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    min-height: 200px;
    min-width: 100%;
    align-items: flex-start;
  }

  .collection-links__link {
    display: flex;
    align-items: center;
    font-size: 1.35rem;
    color: #222 !important;
    background: none;
    border: none;
    border-radius: 0;
    text-decoration: none;
    padding: 0;
    margin: 12px 0;
    font-weight: 600;
    text-transform: uppercase;
    font-family: inherit;
    transition: font-family 0.2s;
  }

  .collection-links__link span:hover {
    -webkit-text-stroke: inherit;
    -webkit-text-stroke-width: 0.5px;
  }

  .collection-links__count{
    font-size: 1rem;
    color: #888;
    margin-left: 12px;
    font-weight: 400;
  }

  h2.h2_title {
    font-size: 1.5rem;
    color: #222;
    font-family: "ZT Nature Regular", sans-serif !important;
    margin: 0;
  }

  .collection-links__container > * {
    display: block;
  }

  .collection-links__images {
    overflow: hidden;
    grid-area: image;

    @media (max-width: 749px) {
      image-block {
        max-width: 100%;
      }
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.collection_links",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
        {
          "type": "select",
          "id": "layout",
          "label": "Layout",
          "options": [
            { "value": "text", "label": "Tekst" },
            { "value": "spotlight", "label": "Spotlight" }
          ],
          "default": "text"
        },
        {
          "type": "select",
          "id": "section_width",
          "label": "Sektion bredde",
          "options": [
            { "value": "page-width", "label": "Sidebredde" },
            { "value": "full-width", "label": "Fuld bredde" }
          ],
          "default": "page-width"
        },
        {
          "type": "select",
          "id": "alignment",
          "label": "Justering",
          "options": [
            { "value": "left", "label": "Venstre" },
            { "value": "center", "label": "Centreret" },
            { "value": "right", "label": "Højre" }
          ],
          "default": "center"
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "Billedposition",
          "options": [
            { "value": "left", "label": "Venstre" },
            { "value": "right", "label": "Højre" }
          ],
          "default": "right"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Farveskema",
          "default": "scheme-1"
        },
        {
          "type": "range",
          "id": "padding_top",
          "label": "Ud fyldning top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "default": 0
        },
        {
          "type": "range",
          "id": "padding_bottom",
          "label": "Ud fyldning bund",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "px",
          "default": 24
        },
        {
          "type": "header",
          "content": "t:content.layout"
        }
  ],
  "presets": [
    {
      "name": "t:names.collection_links_spotlight",
      "category": "t:categories.collections"
    },
    {
      "name": "t:names.collection_links_text"
    }
  ],
  "blocks": [
    {
      "type": "link",
      "name": "Kollektionslink",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Link label"
        },
        {
          "type": "select",
          "id": "link_type",
          "label": "Link type",
          "options": [
            { "value": "collection", "label": "Shopify kollektion" },
            { "value": "custom", "label": "Manuelt link (filter)" }
          ],
          "default": "collection"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Vælg kollektion"
        },
        {
          "type": "url",
          "id": "custom_url",
          "label": "Manuelt link (indsæt URL)",
          "default": "/"
        }
      ]
    }
  ]
}

{% endschema %}